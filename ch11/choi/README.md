---
marp: true
---

# 프록시 패턴

## 최 혁

---

# 프록시 패턴

    특정 객체로의 접근을 제어하는 대리인(특정 객체를 대변하는 객체)을 제공합니다.

**구현 방법**
Subject 인터페이스를 구현한 클래스의 참조값을 갖는 Proxy 객체를 만든다.

**특징**

- 접근을 관리하는 방법이 여러가지가 있다.
  - 원격 프록시: 클라이언트와 원격 객체 사이의 데이터 전달을 관리
  - 가상 프록시: 인스턴스를 만드는데 많은 비용이 드는 객체에 있는 메서드로의 접근을 제어
  - 보호 프록시: 호출하는 쪽의 권한에 따라서 객체에 있는 메서드로의 접근을 제어(제한)
  - 그 외에 캐싱 프록시, 동기화 프록시, 방화벽 프록시, 지연 복사 프록시와 같은 변형 프록시가 있다.

---

# 다양한 프록시

### 원격 프록시 예제(RMI)

- 생성 방법
  1. 공유할 객체의 행동을 담은 원격 인터페이스 정의(클라이언트, 서버)
  2. 원격 인터페이스 구현체(UnicastRemoteObject, 원격 인터페이스 상속) 생성(서버)
  3. 서버에서 RMI 레지스트리 생성 및 서비스 등록
  4. 클라이언트에서 (원격 인터페이스) Naming.lookup("rmi://~~/methodName")으로 호출

**프록시는 네트워크를 통해 클라이언트 요청을 전달하여 네트워크와의 작업의 모든 복잡한 세부 사항을 처리한다.**

---

### 가상 프록시 예제

- 진짜 객체가 필요한 상황이 오기 전까지 객체의 생성을 미룬다.

```java
class ImageProxy implements Icon {
    volatile ImageIcon imageIcon;
    boolean retrieving = false;

    synchronized void setImageIcon(ImageIcon imageIcon) {
        this.imageIcon = imageIcon;
    }

    public void paintIcon(Component c, Graphics g, int x, int y) {
        if (imageIcon != null) {
            imageIcon.paintIcon(c, g, x, y);
        } else {
            g.drawString("앨범 커버를 불러오는 중입니다.", x, y);
            if (!retrieving) {
                retrieving = true;

                // 새 thread로 repaint
            }
        }
    }
}
```

---

# 프록시 패턴과 다른 패턴과의 관계

**데코레이터 패턴**

- 데코레이터 패턴은 행동을 추가하는 용도로 사용되며 프록시 패턴은 어떤 객체의 접근을 제어함
- 따라서 객체의 접근을 통제할 목적일 경우 프록시를 사용하고 행동을 추가하는 목적일 경우 데코레이터 패턴을 사용함

**어댑터 패턴**

- 어댑터는 다른 인터페이스를 지원하도록 변경하지만 프록시는 똑같은 인터페이스를 사용함
- 보호 프록시 패턴은 객체의 접근을 제한하는 목적이기에 클라이언트에게 인터페이스의 일부분만 제공한다는 측면에서 어댑터 패턴과 비슷하다.

---

# 프록시 패턴 활용

### JPA Hibernate

- entityManager.getReference(Member.class, 1L)시 프록시 객체가 반환되어 db에 쿼리를 날리지 않는다.
- 엔티티 조회시 연관관계를 맺은 Lazy 클래스는 프록시를 갖으며 실제 값이 들어있지 않다.(조회시 db에서 가져온다)
- 가상 프록시 패턴이라 할 수 있다.

### Spring

- Spring AOP: 빈 생성시 프록시 패턴을 활용하여 특정 메서드를 실행하기 전후에 횡단관심사를 처리한다.
- @Transactional: @Trainsactional 어노테이션을 붙인 메서드가 있는 빈은 생성시 프록시 객체가 생성되며, 해당 메서드의 실행 전 커넥션을 가져오는 작업을 처리한다.

---

# 요약

- 프록시 패턴은 특정 객체로의 접근을 제어하는 대리인을 제공한다.
- 프록시 패턴은 여러 파생 패턴들이 존재한다.(원격 프록시, 가상 프록시, 동적 프록시 등)
